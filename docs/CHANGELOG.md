# 변경 이력

## 2024년 최신 업데이트

### 주요 변경사항

#### 1. 패스 네트워크 분석 기능 추가
- **변경 내용**: 선수 간 패스 연결 관계 분석 기능 추가
- **영향 파일**:
  - `src/data/loader.py`: 패스 이벤트에 `receiver_name` 메타데이터 추가
  - `src/analysis/player_analysis.py`: `analyze_pass_network()`, `get_player_average_positions()` 함수 추가
  - `src/visualization/plotter.py`: 주요 패스 경로 시각화 추가

#### 2. 히트맵 시각화 개선
- **변경 내용**: 패스 연결선 시각화 단순화 및 색상 팔레트 통일
- **시각화 요소**:
  - 성공한 패스: 파란색 얇은 화살표 (lw=0.7, 앞쪽 10개는 alpha=0.35, 나머지는 alpha=0.2)
  - 실패한 패스: 회색 얇은 화살표 (lw=0.7, alpha=0.25)
  - 슈팅 방향: 노란/주황 화살표 (xG에 따라 색상 및 굵기 조정)

#### 3. 라이브러리 정리
- **제거**: `plotly` (requirements.txt에서 제거, 실제 사용되지 않음)
- **제거**: `mplsoccer` (Python 3.9와 호환되지 않아 완전히 제거)
  - requirements.txt에서 제거
  - 코드에서 모든 mplsoccer 관련 import 및 사용 코드 제거
  - `plot_player_heatmap()` 함수가 항상 기본 matplotlib 사용하도록 단순화

#### 4. 코드 정리
- **제거**: mplsoccer 관련 모든 코드 (import, MPLSOCCER_AVAILABLE 변수, Pitch 사용 코드)
- **단순화**: `plot_player_heatmap()` 함수가 `plot_player_heatmap_basic()`를 직접 호출

### 기술적 세부사항

#### 패스 연결 정보 추출
- `Pass Received` 이벤트와 `Pass` 이벤트를 시간 기반으로 매칭
- 패스 이벤트의 `metadata`에 `receiver_name` 필드 추가
- 성공한 패스만 분석 대상으로 사용

#### 패스 네트워크 분석 알고리즘
1. 변곡점 시점 전후 5분(총 10분) 동안의 성공한 패스만 필터링
2. 선수 간 패스 빈도 계산: `{(passer, receiver): count}`
3. 패스 빈도 기준으로 정렬하여 상위 5개 경로 선정
4. 선수 평균 위치를 기준으로 연결선 그리기

#### 시각화 개선
- 패스 연결선: 파란색 얇은 화살표로 통일 (투명도 조정으로 시각적 계층 구조)
- 슈팅 표시: 원형 마커로 변경, xG에 따라 크기와 색상 조정
  - xG ≥ 0.3: 진한 주황 큰 원 (120px)
  - xG ≥ 0.15: 주황 중간 원 (90px)
  - xG < 0.15: 노랑 작은 원 (70px)
- 범례 업데이트: 슈팅 화살표 정보 추가

### 호환성
- **Python 버전**: 3.9 이상
- **기존 기능**: 모든 기존 기능 유지
- **하위 호환성**: 기존 API 엔드포인트 변경 없음
- **시각화**: matplotlib만 사용 (외부 라이브러리 의존성 최소화)

#### 5. 히트맵 UI 개선
- **변경 내용**: 선수 정보 표시 방식 개선
  - 선수 이름/통계를 필드 위 텍스트에서 오른쪽 사이드 표로 이동
  - 필드 가림 최소화로 데이터 가시성 향상
  - 선수 위치에 번호만 표시 (1, 2, 3, 4, 5)
- **선수 활동 영역 표시 개선**:
  - 원형 영역 표시에서 개별 히트맵으로 변경
  - 각 선수별로 색상이 다른 히트맵으로 활동 밀도 표시
  - 실제 활동 패턴을 더 정확하게 반영

### 문서 업데이트
- `docs/USAGE.md`: 패스 네트워크 분석 기능 설명 추가, 히트맵 UI 개선 사항 반영
- `docs/ALGORITHM.md`: 패스 네트워크 분석 알고리즘 설명 추가
- `docs/VISUALIZATION.md`: 
  - 주요 패스 경로 시각화 설명 추가
  - 모멘텀 곡선 그래프의 가로/세로 축 상세 설명 추가
  - 히트맵 UI 개선 사항 반영 (사이드 표, 개별 히트맵)

#### 6. 히트맵 시각화 추가 개선 (2024년 최신)
- **우측 패널 레이아웃 재구성**:
  - 범례, 선수 통계 표, 변곡점 설명, 전체 설명을 세로 컬럼으로 통일
  - 모든 카드의 좌측 정렬선과 폭 통일
  - 카드 간 간격 일정하게 조정
- **변곡점 설명 박스 최적화**:
  - 여백 최소화 (줄 간격 0.030 → 0.025, 패딩 0.06 → 0.04)
  - 각 설명을 한 줄로 요약 (최대 28자)
  - 가장 중요한 텍스트 카드로 진한 테두리와 굵은 제목
- **전체 설명 박스 최적화**:
  - 여백 최소화 (패딩 0.05 → 0.03)
  - 줄바꿈 기준 완화 (28자 → 35자)
  - 텍스트 생략 제거 (모든 내용 표시)
- **범례 업데이트**:
  - 슈팅 화살표 정보 추가 ("노란/주황 화살표: 슈팅 방향(xG에 따라 색상)")
- **좌표계 및 눈금 추가**:
  - X축 눈금: 필드 하단에 0-100, 10단위로 표시
  - Y축 눈금: 필드 좌측에 0-100, 10단위로 표시
  - X, Y축 설명: 필드 상단에 텍스트 박스로 표시
- **골대 팀 이름 표시**:
  - 각 골대 상단(y=99)에 팀 이름 표시
  - 전반/후반에 따라 골대 위치 자동 결정
  - 전반: 왼쪽(x=0)=홈팀, 오른쪽(x=100)=원정팀
  - 후반: 왼쪽(x=0)=원정팀, 오른쪽(x=100)=홈팀
  - 어두운 배경 박스로 가독성 향상
- **슈팅 방향 로직 개선**:
  - 전반/후반 및 홈/원정팀에 따라 슈팅 방향 자동 결정
  - 데이터는 항상 왼쪽(x=0) → 오른쪽(x=100)으로 통일되어 있으므로, 골대 위치만 조정

#### 7. 모멘텀 곡선 그래프 개선 (2024년 최신)
- **seaborn 스타일 적용**: `whitegrid` 스타일과 `husl` 팔레트
- **그래프 크기**: `figsize=(12, 8)`로 확대
- **선 그래프**: 부드러운 선 (`lw=2.5`), 마커 추가
- **막대 그래프**: 중첩 방지 (`width=3`, `alpha=0.7`)
- **변곡점 강조**: 노란색 산점도 마커, 화살표 주석 추가
- **레이블/범례**: 제목 `fontsize=16`, 축 레이블 `fontsize=14`, 범례 최적화

#### 8. 주피터 노트북 지원 추가 (2024년 최신)
- **노트북 파일 추가**:
  - `analysis_sample.ipynb`: 샘플 데이터 분석용 노트북
  - `analysis_real.ipynb`: 실제 K리그 데이터 분석용 노트북
- **주요 기능**:
  - 이미지 인라인 표시: 생성된 PNG 파일이 노트북 셀에 자동으로 표시
  - 경기 ID 입력 기능: 사용자가 원하는 경기 ID를 직접 입력 가능
  - 페이지네이션 기능: 경기 목록을 10개씩 표시하고 `n`(다음), `p`(이전)로 탐색
  - 경기 정보 검증: 입력한 경기 ID가 목록에 있는지 자동 확인
- **사용자 경험 개선**:
  - 각 분석 단계를 셀 단위로 분리하여 단계별 실행 가능
  - 결과를 노트북 내에서 바로 확인 가능
  - 이미지 파일을 별도로 열지 않아도 노트북에서 바로 확인 가능
