# 시각화 기능 상세 가이드

## 개요

이 프로젝트는 경기 흐름 분석을 위한 3가지 주요 시각화 기능을 제공합니다:
1. 모멘텀 곡선 그래프
2. 선수 위치 히트맵
3. 선수 움직임 그래프

## 1. 모멘텀 곡선 그래프

### 기능
경기 전체의 흐름을 시간에 따라 시각화합니다.

### 생성 방법

```python
from src.visualization.plotter import plot_momentum_curve
from src.analysis.turning_point import detect_turning_points

turning_points = detect_turning_points(match_data)
plot_momentum_curve(match_data, turning_points, "momentum_curve.png")
```

### 그래프 요소

- **파란색 영역**: 홈팀이 우세한 구간 (모멘텀 점수 > 0)
- **빨간색 영역**: 원정팀이 우세한 구간 (모멘텀 점수 < 0)
- **검은 점선**: 경기 주도권이 균형인 상태 (모멘텀 점수 = 0)
- **별표 마커**: 탐지된 변곡점
  - 초록색: 홈팀에 유리한 변곡점
  - 주황색: 원정팀에 유리한 변곡점
- **노란색 박스**: 변곡점 시각 표시

### 해석

- 파란색 영역이 넓을수록 홈팀이 경기를 주도
- 빨간색 영역이 넓을수록 원정팀이 경기를 주도
- 변곡점이 많은 구간은 경기 흐름이 자주 바뀌는 구간
- 모멘텀 점수의 절댓값이 클수록 한 팀이 압도적으로 우세

## 2. 선수 위치 히트맵

### 기능
변곡점 시점의 선수 위치 분포, 패스 연결, 슈팅 방향, 공격/수비 라인을 한눈에 보여줍니다.

### 생성 방법

```python
from src.visualization.plotter import plot_player_heatmap
from src.analysis.player_analysis import extract_player_activities

player_activities = extract_player_activities(match_data, turning_point)
plot_player_heatmap(match_data, turning_point, player_activities, "heatmap.png")
```

### 그래프 요소

#### 배경 히트맵
- **색상**: 노란색 → 주황색 → 빨간색 (활동 빈도 증가)
- **의미**: 선수들이 자주 활동한 위치

#### 패스 연결선
- **청록색 실선 화살표**: 성공한 패스
  - 시작점에 청록색 원 표시
  - 최대 25개 표시
- **주황색 점선 화살표**: 실패한 패스
  - 시작점에 주황색 X 표시
  - 최대 15개 표시

#### 슈팅 표시
- **별 모양 마커**: 슈팅 위치
  - 크기와 색상은 xG에 비례
  - 진한 빨강 (xG ≥ 0.3): 큰 별
  - 토마토색 (xG ≥ 0.15): 중간 별
  - 금색 (xG < 0.15): 작은 별
- **화살표**: 슈팅 방향 (골대 방향)
- **xG 수치**: 슈팅 위치 근처에 표시

#### 공격/수비 라인
- **초록색 세로선**: 공격 라인
  - 공격 이벤트(슈팅, 패스)의 평균 x 좌표
  - 라인이 오른쪽(골대 방향)에 있을수록 공격적
- **빨간색 세로선**: 수비 라인
  - 수비 이벤트의 평균 x 좌표
  - 라인이 왼쪽에 있을수록 수비적

#### 주요 선수 표시
- **색상 원**: 선수 평균 위치
  - 각 선수는 다른 색상으로 구분
  - 원의 크기는 활동 영역 반경
- **선수 이름 및 통계**: 활동 영역 밖에 표시
  - 슈팅/패스 수 표시

#### 필드 라인
- **중앙선**: 흰색 점선 (x = 50)
- **페널티 박스**: 흰색 사각형 (대략적 위치)

### 해석 방법

1. **히트맵 색상**: 어느 지역에서 가장 많은 활동이 있었는지 확인
2. **패스 연결선**: 공격 패턴과 패스 성공률 파악
3. **슈팅 위치**: 위험한 슈팅이 어디서 나왔는지 확인
4. **공격/수비 라인**: 팀의 전술적 위치 형성 상태 파악
5. **선수 위치**: 주요 선수들이 어디서 활동했는지 확인

## 3. 선수 움직임 그래프

### 기능
주요 선수들의 개별 활동 패턴을 히트맵과 이벤트 마커로 시각화합니다.

### 생성 방법

```python
from src.visualization.plotter import plot_player_movements
from src.analysis.player_analysis import extract_player_activities, get_key_players

player_activities = extract_player_activities(match_data, turning_point)
plot_player_movements(match_data, turning_point, player_activities, top_n=5, save_path="movements.png")
```

### 그래프 구성

각 선수마다 개별 서브플롯을 생성합니다.

#### 배경 히트맵
- **색상**: 노란색 → 주황색 → 빨간색
- **의미**: 해당 선수의 위치 분포 (활동 빈도)

#### 이벤트 마커
- **빨간 별**: 슈팅 위치
- **청록 사각형**: 성공한 패스 위치
- **주황 X**: 실패한 패스 위치
- **초록 삼각형**: 수비 액션 위치

#### 선수 통계
각 서브플롯 제목에 다음 정보 표시:
- 슈팅 횟수
- 패스 횟수
- 수비 액션 횟수
- xG 기여도
- 영향도 점수

#### 범례
첫 번째 서브플롯에 범례 표시:
- 각 마커의 의미 설명

### 해석 방법

1. **히트맵**: 선수가 주로 활동한 영역 확인
2. **슈팅 위치**: 선수의 공격 기여도 파악
3. **패스 위치**: 선수의 패스 성공률과 위치 확인
4. **수비 액션**: 선수의 수비 기여도 파악
5. **통계 비교**: 여러 선수의 통계를 비교하여 주요 기여자 식별

## 한글 폰트 설정

모든 그래프는 한글을 지원하는 폰트를 자동으로 설정합니다.

**지원 폰트 (우선순위)**:
1. AppleGothic (macOS)
2. NanumGothic
3. Malgun Gothic
4. NanumBarunGothic

폰트를 찾지 못한 경우 경고 메시지가 표시되며, 한글이 깨질 수 있습니다.

## 그래프 저장 옵션

### 해상도
- 기본 DPI: 300 (고해상도)
- `bbox_inches='tight'`: 여백 최소화
- `pad_inches=0.2`: 히트맵의 경우 약간의 여백 추가

### 파일 형식
- PNG 형식으로 저장
- 투명도 지원

## 사용 팁

1. **히트맵 해석**: 색상이 진한 영역이 해당 시점의 핵심 활동 지역
2. **패스 패턴**: 패스 연결선이 많을수록 공격이 활발했음을 의미
3. **라인 비교**: 공격 라인과 수비 라인의 거리가 가까울수록 압박이 강함
4. **선수 비교**: 여러 변곡점의 히트맵을 비교하여 선수들의 역할 변화 파악
5. **시간대별 비교**: 전반/후반 히트맵을 비교하여 전술 변화 확인

